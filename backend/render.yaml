# Render Blueprint - Infrastructure as Code
# Deploy mit: https://render.com/docs/blueprint-spec

services:
  # ===========================================
  # API Service ($7/Mo)
  # ===========================================
  - type: web
    name: reboss-api
    runtime: python
    rootDir: backend/api
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn main:app --bind 0.0.0.0:$PORT
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: PINTEREST_APP_ID
        sync: false
      - key: PINTEREST_APP_SECRET
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: API_URL
        sync: false
    autoDeploy: true
    plan: starter

  # ===========================================
  # Cron Jobs ($1/Mo je)
  # ===========================================

  - type: cron
    name: sales-tracker
    runtime: python
    rootDir: backend/jobs/sales_tracker
    schedule: "0 2 * * *"  # T채glich 02:00 UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
    plan: starter

  - type: cron
    name: replace-job
    runtime: python
    rootDir: backend/jobs/replace_job
    schedule: "0 4 * * *"  # T채glich 04:00 UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
    plan: starter

  - type: cron
    name: product-creation
    runtime: python
    rootDir: backend/jobs/product_creation
    schedule: "0 6 * * *"  # T채glich 06:00 UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
    plan: starter

  - type: cron
    name: product-optimize
    runtime: python
    rootDir: backend/jobs/product_optimize
    schedule: "0 8 * * *"  # T채glich 08:00 UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
    plan: starter

  - type: cron
    name: pinterest-sync
    runtime: python
    rootDir: backend/jobs/pinterest_sync
    schedule: "0 */4 * * *"  # Alle 4 Stunden
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
    plan: starter
