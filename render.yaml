# Render Blueprint - ReBoss NextGen
# Deploy via GitHub: Connect repo -> Select render.yaml -> Deploy

services:
  # ===========================================
  # API Service (Flask Backend)
  # ===========================================
  - type: web
    name: reboss-api
    runtime: python
    region: frankfurt
    plan: starter  # $7/mo - can upgrade later
    buildCommand: |
      cd backend/api && pip install -r requirements.txt
    startCommand: |
      cd backend/api && gunicorn main:app --bind 0.0.0.0:$PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: SUPABASE_URL
        sync: false  # Set manually in Render Dashboard
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: PINTEREST_APP_ID
        sync: false
      - key: PINTEREST_APP_SECRET
        sync: false
    healthCheckPath: /health
    autoDeploy: true

  # ===========================================
  # Frontend (React/Vite) - Static Site
  # ===========================================
  - type: web
    name: reboss-frontend
    runtime: static
    region: frankfurt
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_SUPABASE_URL
        sync: false
      - key: VITE_SUPABASE_ANON_KEY
        sync: false
      - key: VITE_API_URL
        fromService:
          name: reboss-api
          type: web
          property: host
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    autoDeploy: true

# ===========================================
# Cron Jobs
# ===========================================
crons:
  # Sales Tracker - Daily at 2 AM UTC
  - name: sales-tracker
    runtime: docker
    region: frankfurt
    plan: starter
    schedule: "0 2 * * *"
    dockerfilePath: backend/jobs/sales_tracker/Dockerfile
    dockerContext: backend/jobs/sales_tracker
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false

  # Replace Job - Daily at 4 AM UTC (after sales tracker)
  - name: replace-job
    runtime: docker
    region: frankfurt
    plan: starter
    schedule: "0 4 * * *"
    dockerfilePath: backend/jobs/replace_job/Dockerfile
    dockerContext: backend/jobs/replace_job
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
