{"version":3,"file":"VerifyEmail-BRRBBsuY.js","sources":["../../src/pages/VerifyEmail.tsx"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { useNavigate, useSearchParams } from 'react-router-dom'\nimport { supabase } from '@src/lib/supabase'\nimport { useToastStore } from '@src/lib/store'\nimport { Loader2, CheckCircle, XCircle } from 'lucide-react'\n\ntype VerifyStatus = 'loading' | 'success' | 'error'\n\nexport default function VerifyEmail() {\n  const navigate = useNavigate()\n  const [searchParams] = useSearchParams()\n  const addToast = useToastStore((state) => state.addToast)\n\n  const [status, setStatus] = useState<VerifyStatus>('loading')\n  const [message, setMessage] = useState('E-Mail wird verifiziert...')\n\n  useEffect(() => {\n    const verifyEmail = async () => {\n      try {\n        // Check for error in URL\n        const error = searchParams.get('error')\n        const errorDescription = searchParams.get('error_description')\n\n        if (error) {\n          setStatus('error')\n          setMessage(errorDescription || 'Verifizierung fehlgeschlagen')\n          return\n        }\n\n        // Check for token hash (email confirmation uses hash fragment)\n        const tokenHash = searchParams.get('token_hash')\n        const type = searchParams.get('type')\n\n        if (tokenHash && type === 'email') {\n          // Verify OTP\n          const { error: verifyError } = await supabase.auth.verifyOtp({\n            token_hash: tokenHash,\n            type: 'email',\n          })\n\n          if (verifyError) {\n            setStatus('error')\n            setMessage(verifyError.message)\n            return\n          }\n        }\n\n        // Check if we have a code (alternative flow)\n        const code = searchParams.get('code')\n        if (code) {\n          const { error: exchangeError } =\n            await supabase.auth.exchangeCodeForSession(code)\n\n          if (exchangeError) {\n            setStatus('error')\n            setMessage(exchangeError.message)\n            return\n          }\n        }\n\n        // If no tokens/codes, check current session\n        const {\n          data: { session },\n        } = await supabase.auth.getSession()\n\n        if (session?.user?.email_confirmed_at) {\n          setStatus('success')\n          setMessage('Deine E-Mail-Adresse wurde erfolgreich verifiziert!')\n          addToast({\n            type: 'success',\n            title: 'E-Mail verifiziert',\n            description: 'Du kannst dich jetzt anmelden.',\n          })\n\n          // Redirect to dashboard after delay\n          setTimeout(() => {\n            navigate('/onboarding', { replace: true })\n          }, 2000)\n        } else if (!tokenHash && !code) {\n          // No verification params and no session\n          setStatus('error')\n          setMessage('Ung√ºltiger Verifizierungslink')\n        }\n      } catch (err) {\n        console.error('Verification error:', err)\n        setStatus('error')\n        setMessage('Ein unerwarteter Fehler ist aufgetreten')\n      }\n    }\n\n    verifyEmail()\n  }, [searchParams, navigate, addToast])\n\n  return (\n    <div className=\"min-h-screen bg-black flex items-center justify-center p-8\">\n      <div className=\"max-w-md w-full text-center\">\n        {/* Loading */}\n        {status === 'loading' && (\n          <>\n            <div className=\"w-20 h-20 rounded-full bg-violet-500/10 flex items-center justify-center mx-auto mb-6\">\n              <Loader2 className=\"w-10 h-10 text-violet-500 animate-spin\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-white mb-4\">\n              Verifizierung...\n            </h1>\n            <p className=\"text-zinc-400\">{message}</p>\n          </>\n        )}\n\n        {/* Success */}\n        {status === 'success' && (\n          <>\n            <div className=\"w-20 h-20 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-6\">\n              <CheckCircle className=\"w-10 h-10 text-emerald-500\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-white mb-4\">\n              E-Mail verifiziert!\n            </h1>\n            <p className=\"text-zinc-400 mb-8\">{message}</p>\n            <div className=\"flex items-center justify-center gap-2 text-zinc-500\">\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n              <span className=\"text-sm\">Weiterleitung...</span>\n            </div>\n          </>\n        )}\n\n        {/* Error */}\n        {status === 'error' && (\n          <>\n            <div className=\"w-20 h-20 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-6\">\n              <XCircle className=\"w-10 h-10 text-red-500\" />\n            </div>\n            <h1 className=\"text-2xl font-bold text-white mb-4\">\n              Verifizierung fehlgeschlagen\n            </h1>\n            <p className=\"text-zinc-400 mb-8\">{message}</p>\n            <div className=\"space-y-4\">\n              <button\n                onClick={() => navigate('/login')}\n                className=\"btn-primary w-full py-3\"\n              >\n                Zum Login\n              </button>\n              <p className=\"text-sm text-zinc-500\">\n                Probleme?{' '}\n                <a\n                  href=\"mailto:support@pod-autom.de\"\n                  className=\"text-violet-400 hover:text-violet-300\"\n                >\n                  Kontaktiere den Support\n                </a>\n              </p>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":["VerifyEmail","navigate","useNavigate","searchParams","useSearchParams","addToast","useToastStore","state","status","setStatus","useState","message","setMessage","useEffect","error","errorDescription","tokenHash","type","verifyError","supabase","code","exchangeError","session","err","jsxs","Fragment","jsx","Loader2","CheckCircle","XCircle"],"mappings":"+RAQA,SAAwBA,GAAc,CACpC,MAAMC,EAAWC,EAAA,EACX,CAACC,CAAY,EAAIC,EAAA,EACjBC,EAAWC,EAAeC,GAAUA,EAAM,QAAQ,EAElD,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAuB,SAAS,EACtD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,4BAA4B,EAEnEG,OAAAA,EAAAA,UAAU,IAAM,EACM,SAAY,CAC9B,GAAI,CAEF,MAAMC,EAAQX,EAAa,IAAI,OAAO,EAChCY,EAAmBZ,EAAa,IAAI,mBAAmB,EAE7D,GAAIW,EAAO,CACTL,EAAU,OAAO,EACjBG,EAAWG,GAAoB,8BAA8B,EAC7D,MACF,CAGA,MAAMC,EAAYb,EAAa,IAAI,YAAY,EACzCc,EAAOd,EAAa,IAAI,MAAM,EAEpC,GAAIa,GAAaC,IAAS,QAAS,CAEjC,KAAM,CAAE,MAAOC,CAAA,EAAgB,MAAMC,EAAS,KAAK,UAAU,CAC3D,WAAYH,EACZ,KAAM,OAAA,CACP,EAED,GAAIE,EAAa,CACfT,EAAU,OAAO,EACjBG,EAAWM,EAAY,OAAO,EAC9B,MACF,CACF,CAGA,MAAME,EAAOjB,EAAa,IAAI,MAAM,EACpC,GAAIiB,EAAM,CACR,KAAM,CAAE,MAAOC,CAAA,EACb,MAAMF,EAAS,KAAK,uBAAuBC,CAAI,EAEjD,GAAIC,EAAe,CACjBZ,EAAU,OAAO,EACjBG,EAAWS,EAAc,OAAO,EAChC,MACF,CACF,CAGA,KAAM,CACJ,KAAM,CAAE,QAAAC,CAAA,CAAQ,EACd,MAAMH,EAAS,KAAK,WAAA,EAEpBG,GAAS,MAAM,oBACjBb,EAAU,SAAS,EACnBG,EAAW,qDAAqD,EAChEP,EAAS,CACP,KAAM,UACN,MAAO,qBACP,YAAa,gCAAA,CACd,EAGD,WAAW,IAAM,CACfJ,EAAS,cAAe,CAAE,QAAS,EAAA,CAAM,CAC3C,EAAG,GAAI,GACE,CAACe,GAAa,CAACI,IAExBX,EAAU,OAAO,EACjBG,EAAW,+BAA+B,EAE9C,OAASW,EAAK,CACZ,QAAQ,MAAM,sBAAuBA,CAAG,EACxCd,EAAU,OAAO,EACjBG,EAAW,yCAAyC,CACtD,CACF,GAEA,CACF,EAAG,CAACT,EAAcF,EAAUI,CAAQ,CAAC,QAGlC,MAAA,CAAI,UAAU,6DACb,SAAAmB,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAEZ,SAAA,CAAAhB,IAAW,WACVgB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,wFACb,eAACC,EAAA,CAAQ,UAAU,yCAAyC,CAAA,CAC9D,EACAD,EAAAA,IAAC,KAAA,CAAG,UAAU,qCAAqC,SAAA,mBAEnD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAiB,SAAAf,CAAA,CAAQ,CAAA,EACxC,EAIDH,IAAW,WACVgB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,yFACb,eAACE,EAAA,CAAY,UAAU,6BAA6B,CAAA,CACtD,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,qCAAqC,SAAA,sBAEnD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,qBAAsB,SAAAf,EAAQ,EAC3Ca,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAQ,UAAU,sBAAA,CAAuB,EAC1CD,EAAAA,IAAC,OAAA,CAAK,UAAU,UAAU,SAAA,kBAAA,CAAgB,CAAA,CAAA,CAC5C,CAAA,EACF,EAIDlB,IAAW,SACVgB,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,qFACb,eAACG,EAAA,CAAQ,UAAU,yBAAyB,CAAA,CAC9C,EACAH,EAAAA,IAAC,KAAA,CAAG,UAAU,qCAAqC,SAAA,+BAEnD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,qBAAsB,SAAAf,EAAQ,EAC3Ca,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMzB,EAAS,QAAQ,EAChC,UAAU,0BACX,SAAA,WAAA,CAAA,EAGDuB,EAAAA,KAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,CAAA,YACzB,IACVE,EAAAA,IAAC,IAAA,CACC,KAAK,8BACL,UAAU,wCACX,SAAA,yBAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,CAEJ"}