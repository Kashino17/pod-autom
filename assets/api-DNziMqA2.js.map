{"version":3,"file":"api-DNziMqA2.js","sources":["../../src/lib/api.ts"],"sourcesContent":["import { supabase } from './supabase'\nimport type { Database } from './database.types'\n\ntype Tables = Database['public']['Tables']\n\n// =====================================================\n// HTTP API CLIENT (for backend API calls)\n// =====================================================\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5001'\n\nasync function getAuthHeaders(): Promise<HeadersInit> {\n  const { data } = await supabase.auth.getSession()\n  const token = data.session?.access_token\n\n  return {\n    'Content-Type': 'application/json',\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\n  }\n}\n\n/**\n * HTTP API client for backend requests\n */\nexport const api = {\n  async get<T>(endpoint: string): Promise<T> {\n    const headers = await getAuthHeaders()\n    const response = await fetch(`${API_URL}${endpoint}`, {\n      method: 'GET',\n      headers,\n    })\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Request failed' }))\n      throw new Error(error.error || 'Request failed')\n    }\n\n    return response.json()\n  },\n\n  async post<T>(endpoint: string, data?: unknown): Promise<T> {\n    const headers = await getAuthHeaders()\n    const options: RequestInit = {\n      method: 'POST',\n      headers,\n    }\n\n    if (data !== undefined) {\n      options.body = JSON.stringify(data)\n    }\n\n    const response = await fetch(`${API_URL}${endpoint}`, options)\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Request failed' }))\n      throw new Error(error.error || 'Request failed')\n    }\n\n    return response.json()\n  },\n\n  async put<T>(endpoint: string, data?: unknown): Promise<T> {\n    const headers = await getAuthHeaders()\n    const options: RequestInit = {\n      method: 'PUT',\n      headers,\n    }\n\n    if (data !== undefined) {\n      options.body = JSON.stringify(data)\n    }\n\n    const response = await fetch(`${API_URL}${endpoint}`, options)\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Request failed' }))\n      throw new Error(error.error || 'Request failed')\n    }\n\n    return response.json()\n  },\n\n  async delete<T>(endpoint: string): Promise<T> {\n    const headers = await getAuthHeaders()\n    const response = await fetch(`${API_URL}${endpoint}`, {\n      method: 'DELETE',\n      headers,\n    })\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Request failed' }))\n      throw new Error(error.error || 'Request failed')\n    }\n\n    return response.json()\n  },\n}\n\n// =====================================================\n// GENERIC CRUD HELPERS\n// =====================================================\n\ninterface QueryOptions {\n  limit?: number\n  offset?: number\n  orderBy?: { column: string; ascending?: boolean }\n}\n\n/**\n * Generic Select mit Typisierung\n */\nexport async function select<T extends keyof Tables>(\n  table: T,\n  options?: QueryOptions & { filter?: Partial<Tables[T]['Row']> }\n) {\n  let query = supabase.from(table).select('*')\n\n  if (options?.filter) {\n    Object.entries(options.filter).forEach(([key, value]) => {\n      if (value !== undefined) {\n        query = query.eq(key, value)\n      }\n    })\n  }\n\n  if (options?.orderBy) {\n    query = query.order(options.orderBy.column, {\n      ascending: options.orderBy.ascending ?? true,\n    })\n  }\n\n  if (options?.limit) {\n    query = query.limit(options.limit)\n  }\n\n  if (options?.offset) {\n    query = query.range(options.offset, options.offset + (options.limit ?? 10) - 1)\n  }\n\n  const { data, error } = await query\n\n  return { data: data as Tables[T]['Row'][] | null, error }\n}\n\n/**\n * Generic Insert\n */\nexport async function insert<T extends keyof Tables>(\n  table: T,\n  data: Tables[T]['Insert']\n) {\n  const { data: result, error } = await supabase\n    .from(table)\n    .insert(data as never)\n    .select()\n    .single()\n\n  return { data: result as Tables[T]['Row'] | null, error }\n}\n\n/**\n * Generic Update\n */\nexport async function update<T extends keyof Tables>(\n  table: T,\n  id: string,\n  data: Tables[T]['Update']\n) {\n  const { data: result, error } = await supabase\n    .from(table)\n    .update(data as never)\n    .eq('id' as never, id as never)\n    .select()\n    .single()\n\n  return { data: result as Tables[T]['Row'] | null, error }\n}\n\n/**\n * Generic Delete\n */\nexport async function remove<T extends keyof Tables>(table: T, id: string) {\n  const { error } = await supabase.from(table).delete().eq('id' as never, id as never)\n\n  return { error }\n}\n\n// =====================================================\n// POD AUTOM SPECIFIC HELPERS\n// =====================================================\n\n/**\n * Holt Subscription fuer User\n */\nexport async function getSubscription(userId: string) {\n  const { data, error } = await supabase\n    .from('pod_autom_subscriptions')\n    .select('*')\n    .eq('user_id', userId)\n    .eq('status', 'active')\n    .maybeSingle()\n\n  return { subscription: data, error }\n}\n\n/**\n * Holt alle Shops eines Users\n */\nexport async function getShops(userId: string) {\n  const { data, error } = await supabase\n    .from('pod_autom_shops')\n    .select('*')\n    .eq('user_id', userId)\n    .order('created_at', { ascending: false })\n\n  return { shops: data ?? [], error }\n}\n\n/**\n * Holt Shop mit Settings\n */\nexport async function getShopWithSettings(shopId: string) {\n  const { data, error } = await supabase\n    .from('pod_autom_shops')\n    .select(\n      `\n      *,\n      pod_autom_settings (*)\n    `\n    )\n    .eq('id', shopId)\n    .single()\n\n  return { shop: data, error }\n}\n\n/**\n * Holt Niches fuer Settings\n */\nexport async function getNiches(settingsId: string) {\n  const { data, error } = await supabase\n    .from('pod_autom_niches')\n    .select('*')\n    .eq('settings_id', settingsId)\n    .order('created_at', { ascending: true })\n\n  return { niches: data ?? [], error }\n}\n\n/**\n * Holt Prompts fuer Settings\n */\nexport async function getPrompts(settingsId: string) {\n  const { data, error } = await supabase\n    .from('pod_autom_prompts')\n    .select('*')\n    .eq('settings_id', settingsId)\n    .order('prompt_type', { ascending: true })\n\n  return { prompts: data ?? [], error }\n}\n\n/**\n * Holt Katalog-Produkte\n */\nexport async function getCatalog() {\n  const { data, error } = await supabase\n    .from('pod_autom_catalog')\n    .select('*')\n    .eq('is_active', true)\n    .order('sort_order', { ascending: true })\n\n  return { catalog: data ?? [], error }\n}\n\n/**\n * Zaehlt aktive Niches fuer Limit-Check\n */\nexport async function countActiveNiches(settingsId: string) {\n  const { count, error } = await supabase\n    .from('pod_autom_niches')\n    .select('*', { count: 'exact', head: true })\n    .eq('settings_id', settingsId)\n    .eq('is_active', true)\n\n  return { count: count ?? 0, error }\n}\n"],"names":["API_URL","getAuthHeaders","data","supabase","token","api","endpoint","headers","response","error","options"],"mappings":"wCASA,MAAMA,EAAU,wBAEhB,eAAeC,GAAuC,CACpD,KAAM,CAAE,KAAAC,CAAA,EAAS,MAAMC,EAAS,KAAK,WAAA,EAC/BC,EAAQF,EAAK,SAAS,aAE5B,MAAO,CACL,eAAgB,mBAChB,GAAIE,EAAQ,CAAE,cAAe,UAAUA,CAAK,IAAO,CAAA,CAAC,CAExD,CAKO,MAAMC,EAAM,CACjB,MAAM,IAAOC,EAA8B,CACzC,MAAMC,EAAU,MAAMN,EAAA,EAChBO,EAAW,MAAM,MAAM,GAAGR,CAAO,GAAGM,CAAQ,GAAI,CACpD,OAAQ,MACR,QAAAC,CAAA,CACD,EAED,GAAI,CAACC,EAAS,GAAI,CAChB,MAAMC,EAAQ,MAAMD,EAAS,KAAA,EAAO,MAAM,KAAO,CAAE,MAAO,gBAAA,EAAmB,EAC7E,MAAM,IAAI,MAAMC,EAAM,OAAS,gBAAgB,CACjD,CAEA,OAAOD,EAAS,KAAA,CAClB,EAEA,MAAM,KAAQF,EAAkBJ,EAA4B,CAE1D,MAAMQ,EAAuB,CAC3B,OAAQ,OACR,QAHc,MAAMT,EAAA,CAGpB,EAGEC,IAAS,SACXQ,EAAQ,KAAO,KAAK,UAAUR,CAAI,GAGpC,MAAMM,EAAW,MAAM,MAAM,GAAGR,CAAO,GAAGM,CAAQ,GAAII,CAAO,EAE7D,GAAI,CAACF,EAAS,GAAI,CAChB,MAAMC,EAAQ,MAAMD,EAAS,KAAA,EAAO,MAAM,KAAO,CAAE,MAAO,gBAAA,EAAmB,EAC7E,MAAM,IAAI,MAAMC,EAAM,OAAS,gBAAgB,CACjD,CAEA,OAAOD,EAAS,KAAA,CAClB,EAEA,MAAM,IAAOF,EAAkBJ,EAA4B,CAEzD,MAAMQ,EAAuB,CAC3B,OAAQ,MACR,QAHc,MAAMT,EAAA,CAGpB,EAGEC,IAAS,SACXQ,EAAQ,KAAO,KAAK,UAAUR,CAAI,GAGpC,MAAMM,EAAW,MAAM,MAAM,GAAGR,CAAO,GAAGM,CAAQ,GAAII,CAAO,EAE7D,GAAI,CAACF,EAAS,GAAI,CAChB,MAAMC,EAAQ,MAAMD,EAAS,KAAA,EAAO,MAAM,KAAO,CAAE,MAAO,gBAAA,EAAmB,EAC7E,MAAM,IAAI,MAAMC,EAAM,OAAS,gBAAgB,CACjD,CAEA,OAAOD,EAAS,KAAA,CAClB,EAEA,MAAM,OAAUF,EAA8B,CAC5C,MAAMC,EAAU,MAAMN,EAAA,EAChBO,EAAW,MAAM,MAAM,GAAGR,CAAO,GAAGM,CAAQ,GAAI,CACpD,OAAQ,SACR,QAAAC,CAAA,CACD,EAED,GAAI,CAACC,EAAS,GAAI,CAChB,MAAMC,EAAQ,MAAMD,EAAS,KAAA,EAAO,MAAM,KAAO,CAAE,MAAO,gBAAA,EAAmB,EAC7E,MAAM,IAAI,MAAMC,EAAM,OAAS,gBAAgB,CACjD,CAEA,OAAOD,EAAS,KAAA,CAClB,CACF"}