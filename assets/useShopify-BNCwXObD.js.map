{"version":3,"file":"useShopify-BNCwXObD.js","sources":["../../src/hooks/useShopify.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@src/contexts/AuthContext'\nimport { api } from '@src/lib/api'\nimport { useToastStore } from '@src/lib/store'\n\n// =====================================================\n// TYPES\n// =====================================================\n\nexport interface Shop {\n  id: string\n  shop_domain: string\n  internal_name: string | null\n  connection_status: 'connected' | 'disconnected' | 'error'\n  created_at: string\n}\n\nexport interface ShopSettings {\n  id: string\n  shop_id: string\n  enabled: boolean\n  gpt_image_quality: 'LOW' | 'MEDIUM' | 'HIGH'\n  creation_limit: number\n  auto_publish: boolean\n  default_price: number\n  default_compare_at_price: number | null\n  created_at: string\n  updated_at: string\n}\n\nexport interface Niche {\n  id: string\n  settings_id: string\n  niche_name: string\n  niche_slug: string\n  is_active: boolean\n  created_at: string\n}\n\n// =====================================================\n// SHOPS HOOK\n// =====================================================\n\nexport function useShops() {\n  const { session } = useAuth()\n  const addToast = useToastStore((state) => state.addToast)\n  const queryClient = useQueryClient()\n\n  // Fetch shops\n  const {\n    data: shops,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: ['pod-autom-shops'],\n    queryFn: async () => {\n      const response = await api.get<{ success: boolean; shops: Shop[] }>(\n        '/api/pod-autom/shops'\n      )\n      if (!response.success) {\n        throw new Error('Failed to fetch shops')\n      }\n      return response.shops\n    },\n    enabled: !!session,\n  })\n\n  // Create shop mutation (manual connection)\n  const createShopMutation = useMutation({\n    mutationFn: async (data: {\n      shop_domain: string\n      access_token: string\n      internal_name?: string\n    }) => {\n      const response = await api.post<{ success: boolean; shop: Shop; error?: string }>(\n        '/api/pod-autom/shops',\n        data\n      )\n      if (!response.success) {\n        throw new Error(response.error || 'Failed to create shop')\n      }\n      return response.shop\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-shops'] })\n      addToast({\n        type: 'success',\n        title: 'Shop verbunden',\n        description: 'Der Shop wurde erfolgreich verbunden.',\n      })\n    },\n    onError: (error: Error) => {\n      addToast({\n        type: 'error',\n        title: 'Fehler',\n        description: error.message,\n      })\n    },\n  })\n\n  // Delete shop mutation\n  const deleteShopMutation = useMutation({\n    mutationFn: async (shopId: string) => {\n      const response = await api.delete<{ success: boolean; error?: string }>(\n        `/api/pod-autom/shops/${shopId}`\n      )\n      if (!response.success) {\n        throw new Error(response.error || 'Failed to delete shop')\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-shops'] })\n      addToast({\n        type: 'success',\n        title: 'Shop entfernt',\n        description: 'Der Shop wurde erfolgreich entfernt.',\n      })\n    },\n    onError: (error: Error) => {\n      addToast({\n        type: 'error',\n        title: 'Fehler',\n        description: error.message,\n      })\n    },\n  })\n\n  // Test connection mutation\n  const testConnectionMutation = useMutation({\n    mutationFn: async (shopId: string) => {\n      const response = await api.post<{\n        success: boolean\n        status: string\n        error?: string\n      }>(`/api/pod-autom/shops/${shopId}/test`)\n      return response\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-shops'] })\n      if (data.success) {\n        addToast({\n          type: 'success',\n          title: 'Verbindung OK',\n          description: 'Die Shop-Verbindung funktioniert.',\n        })\n      } else {\n        addToast({\n          type: 'error',\n          title: 'Verbindungsfehler',\n          description: data.error || 'Die Verbindung konnte nicht hergestellt werden.',\n        })\n      }\n    },\n  })\n\n  // Start Shopify OAuth flow\n  const startOAuthFlow = (shopDomain: string, userId: string) => {\n    const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:5001'\n    const cleanDomain = shopDomain\n      .toLowerCase()\n      .trim()\n      .replace(/^https?:\\/\\//, '')\n      .replace(/\\/$/, '')\n\n    window.location.href = `${apiUrl}/api/pod-autom/shopify/install?shop=${cleanDomain}&user_id=${userId}`\n  }\n\n  return {\n    shops: shops || [],\n    isLoading,\n    error,\n    refetch,\n    createShop: createShopMutation.mutate,\n    isCreating: createShopMutation.isPending,\n    deleteShop: deleteShopMutation.mutate,\n    isDeleting: deleteShopMutation.isPending,\n    testConnection: testConnectionMutation.mutate,\n    isTesting: testConnectionMutation.isPending,\n    startOAuthFlow,\n  }\n}\n\n// =====================================================\n// SETTINGS HOOK\n// =====================================================\n\nexport function useShopSettings(shopId: string | null) {\n  const { session } = useAuth()\n  const addToast = useToastStore((state) => state.addToast)\n  const queryClient = useQueryClient()\n\n  // Fetch settings\n  const {\n    data: settings,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: ['pod-autom-settings', shopId],\n    queryFn: async () => {\n      if (!shopId) return null\n      const response = await api.get<{\n        success: boolean\n        settings: ShopSettings | null\n      }>(`/api/pod-autom/settings/${shopId}`)\n      return response.settings\n    },\n    enabled: !!session && !!shopId,\n  })\n\n  // Update settings mutation\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (data: Partial<ShopSettings>) => {\n      if (!shopId) throw new Error('No shop selected')\n      const response = await api.put<{\n        success: boolean\n        settings: ShopSettings\n        error?: string\n      }>(`/api/pod-autom/settings/${shopId}`, data)\n      if (!response.success) {\n        throw new Error(response.error || 'Failed to update settings')\n      }\n      return response.settings\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-settings', shopId] })\n      addToast({\n        type: 'success',\n        title: 'Einstellungen gespeichert',\n      })\n    },\n    onError: (error: Error) => {\n      addToast({\n        type: 'error',\n        title: 'Fehler',\n        description: error.message,\n      })\n    },\n  })\n\n  return {\n    settings,\n    isLoading,\n    error,\n    updateSettings: updateSettingsMutation.mutate,\n    isUpdating: updateSettingsMutation.isPending,\n  }\n}\n\n// =====================================================\n// NICHES HOOK\n// =====================================================\n\nexport function useNiches(settingsId: string | null) {\n  const { session } = useAuth()\n  const addToast = useToastStore((state) => state.addToast)\n  const queryClient = useQueryClient()\n\n  // Fetch niches\n  const {\n    data: niches,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: ['pod-autom-niches', settingsId],\n    queryFn: async () => {\n      if (!settingsId) return []\n      const response = await api.get<{\n        success: boolean\n        niches: Niche[]\n      }>(`/api/pod-autom/niches/${settingsId}`)\n      return response.niches\n    },\n    enabled: !!session && !!settingsId,\n  })\n\n  // Create niche mutation\n  const createNicheMutation = useMutation({\n    mutationFn: async (nicheName: string) => {\n      if (!settingsId) throw new Error('No settings selected')\n      const response = await api.post<{\n        success: boolean\n        niche: Niche\n        error?: string\n      }>(`/api/pod-autom/niches/${settingsId}`, { niche_name: nicheName })\n      if (!response.success) {\n        throw new Error(response.error || 'Failed to create niche')\n      }\n      return response.niche\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-niches', settingsId] })\n      addToast({\n        type: 'success',\n        title: 'Nische hinzugefuegt',\n      })\n    },\n    onError: (error: Error) => {\n      addToast({\n        type: 'error',\n        title: 'Fehler',\n        description: error.message,\n      })\n    },\n  })\n\n  // Delete niche mutation\n  const deleteNicheMutation = useMutation({\n    mutationFn: async (nicheId: string) => {\n      if (!settingsId) throw new Error('No settings selected')\n      const response = await api.delete<{ success: boolean; error?: string }>(\n        `/api/pod-autom/niches/${settingsId}/${nicheId}`\n      )\n      if (!response.success) {\n        throw new Error(response.error || 'Failed to delete niche')\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pod-autom-niches', settingsId] })\n      addToast({\n        type: 'success',\n        title: 'Nische entfernt',\n      })\n    },\n    onError: (error: Error) => {\n      addToast({\n        type: 'error',\n        title: 'Fehler',\n        description: error.message,\n      })\n    },\n  })\n\n  return {\n    niches: niches || [],\n    isLoading,\n    error,\n    createNiche: createNicheMutation.mutate,\n    isCreating: createNicheMutation.isPending,\n    deleteNiche: deleteNicheMutation.mutate,\n    isDeleting: deleteNicheMutation.isPending,\n  }\n}\n"],"names":["useShops","session","useAuth","addToast","useToastStore","state","queryClient","useQueryClient","shops","isLoading","error","refetch","useQuery","response","api","createShopMutation","useMutation","data","deleteShopMutation","shopId","testConnectionMutation","startOAuthFlow","shopDomain","userId","apiUrl","cleanDomain","useShopSettings","settings","updateSettingsMutation","useNiches","settingsId","niches","createNicheMutation","nicheName","deleteNicheMutation","nicheId"],"mappings":"6IA2CO,SAASA,GAAW,CACzB,KAAM,CAAE,QAAAC,CAAA,EAAYC,EAAA,EACdC,EAAWC,EAAeC,GAAUA,EAAM,QAAQ,EAClDC,EAAcC,EAAA,EAGd,CACJ,KAAMC,EACN,UAAAC,EACA,MAAAC,EACA,QAAAC,CAAA,EACEC,EAAS,CACX,SAAU,CAAC,iBAAiB,EAC5B,QAAS,SAAY,CACnB,MAAMC,EAAW,MAAMC,EAAI,IACzB,sBAAA,EAEF,GAAI,CAACD,EAAS,QACZ,MAAM,IAAI,MAAM,uBAAuB,EAEzC,OAAOA,EAAS,KAClB,EACA,QAAS,CAAC,CAACZ,CAAA,CACZ,EAGKc,EAAqBC,EAAY,CACrC,WAAY,MAAOC,GAIb,CACJ,MAAMJ,EAAW,MAAMC,EAAI,KACzB,uBACAG,CAAA,EAEF,GAAI,CAACJ,EAAS,QACZ,MAAM,IAAI,MAAMA,EAAS,OAAS,uBAAuB,EAE3D,OAAOA,EAAS,IAClB,EACA,UAAW,IAAM,CACfP,EAAY,kBAAkB,CAAE,SAAU,CAAC,iBAAiB,EAAG,EAC/DH,EAAS,CACP,KAAM,UACN,MAAO,iBACP,YAAa,uCAAA,CACd,CACH,EACA,QAAUO,GAAiB,CACzBP,EAAS,CACP,KAAM,QACN,MAAO,SACP,YAAaO,EAAM,OAAA,CACpB,CACH,CAAA,CACD,EAGKQ,EAAqBF,EAAY,CACrC,WAAY,MAAOG,GAAmB,CACpC,MAAMN,EAAW,MAAMC,EAAI,OACzB,wBAAwBK,CAAM,EAAA,EAEhC,GAAI,CAACN,EAAS,QACZ,MAAM,IAAI,MAAMA,EAAS,OAAS,uBAAuB,CAE7D,EACA,UAAW,IAAM,CACfP,EAAY,kBAAkB,CAAE,SAAU,CAAC,iBAAiB,EAAG,EAC/DH,EAAS,CACP,KAAM,UACN,MAAO,gBACP,YAAa,sCAAA,CACd,CACH,EACA,QAAUO,GAAiB,CACzBP,EAAS,CACP,KAAM,QACN,MAAO,SACP,YAAaO,EAAM,OAAA,CACpB,CACH,CAAA,CACD,EAGKU,EAAyBJ,EAAY,CACzC,WAAY,MAAOG,GACA,MAAML,EAAI,KAIxB,wBAAwBK,CAAM,OAAO,EAG1C,UAAYF,GAAS,CACnBX,EAAY,kBAAkB,CAAE,SAAU,CAAC,iBAAiB,EAAG,EAC3DW,EAAK,QACPd,EAAS,CACP,KAAM,UACN,MAAO,gBACP,YAAa,mCAAA,CACd,EAEDA,EAAS,CACP,KAAM,QACN,MAAO,oBACP,YAAac,EAAK,OAAS,iDAAA,CAC5B,CAEL,CAAA,CACD,EAGKI,EAAiB,CAACC,EAAoBC,IAAmB,CAC7D,MAAMC,EAAS,wBACTC,EAAcH,EACjB,YAAA,EACA,KAAA,EACA,QAAQ,eAAgB,EAAE,EAC1B,QAAQ,MAAO,EAAE,EAEpB,OAAO,SAAS,KAAO,GAAGE,CAAM,uCAAuCC,CAAW,YAAYF,CAAM,EACtG,EAEA,MAAO,CACL,MAAOf,GAAS,CAAA,EAChB,UAAAC,EACA,MAAAC,EACA,QAAAC,EACA,WAAYI,EAAmB,OAC/B,WAAYA,EAAmB,UAC/B,WAAYG,EAAmB,OAC/B,WAAYA,EAAmB,UAC/B,eAAgBE,EAAuB,OACvC,UAAWA,EAAuB,UAClC,eAAAC,CAAA,CAEJ,CAMO,SAASK,EAAgBP,EAAuB,CACrD,KAAM,CAAE,QAAAlB,CAAA,EAAYC,EAAA,EACdC,EAAWC,EAAeC,GAAUA,EAAM,QAAQ,EAClDC,EAAcC,EAAA,EAGd,CACJ,KAAMoB,EACN,UAAAlB,EACA,MAAAC,CAAA,EACEE,EAAS,CACX,SAAU,CAAC,qBAAsBO,CAAM,EACvC,QAAS,SACFA,GACY,MAAML,EAAI,IAGxB,2BAA2BK,CAAM,EAAE,GACtB,SALI,KAOtB,QAAS,CAAC,CAAClB,GAAW,CAAC,CAACkB,CAAA,CACzB,EAGKS,EAAyBZ,EAAY,CACzC,WAAY,MAAOC,GAAgC,CACjD,GAAI,CAACE,EAAQ,MAAM,IAAI,MAAM,kBAAkB,EAC/C,MAAMN,EAAW,MAAMC,EAAI,IAIxB,2BAA2BK,CAAM,GAAIF,CAAI,EAC5C,GAAI,CAACJ,EAAS,QACZ,MAAM,IAAI,MAAMA,EAAS,OAAS,2BAA2B,EAE/D,OAAOA,EAAS,QAClB,EACA,UAAW,IAAM,CACfP,EAAY,kBAAkB,CAAE,SAAU,CAAC,qBAAsBa,CAAM,EAAG,EAC1EhB,EAAS,CACP,KAAM,UACN,MAAO,2BAAA,CACR,CACH,EACA,QAAUO,GAAiB,CACzBP,EAAS,CACP,KAAM,QACN,MAAO,SACP,YAAaO,EAAM,OAAA,CACpB,CACH,CAAA,CACD,EAED,MAAO,CACL,SAAAiB,EACA,UAAAlB,EACA,MAAAC,EACA,eAAgBkB,EAAuB,OACvC,WAAYA,EAAuB,SAAA,CAEvC,CAMO,SAASC,EAAUC,EAA2B,CACnD,KAAM,CAAE,QAAA7B,CAAA,EAAYC,EAAA,EACdC,EAAWC,EAAeC,GAAUA,EAAM,QAAQ,EAClDC,EAAcC,EAAA,EAGd,CACJ,KAAMwB,EACN,UAAAtB,EACA,MAAAC,CAAA,EACEE,EAAS,CACX,SAAU,CAAC,mBAAoBkB,CAAU,EACzC,QAAS,SACFA,GACY,MAAMhB,EAAI,IAGxB,yBAAyBgB,CAAU,EAAE,GACxB,OALQ,CAAA,EAO1B,QAAS,CAAC,CAAC7B,GAAW,CAAC,CAAC6B,CAAA,CACzB,EAGKE,EAAsBhB,EAAY,CACtC,WAAY,MAAOiB,GAAsB,CACvC,GAAI,CAACH,EAAY,MAAM,IAAI,MAAM,sBAAsB,EACvD,MAAMjB,EAAW,MAAMC,EAAI,KAIxB,yBAAyBgB,CAAU,GAAI,CAAE,WAAYG,EAAW,EACnE,GAAI,CAACpB,EAAS,QACZ,MAAM,IAAI,MAAMA,EAAS,OAAS,wBAAwB,EAE5D,OAAOA,EAAS,KAClB,EACA,UAAW,IAAM,CACfP,EAAY,kBAAkB,CAAE,SAAU,CAAC,mBAAoBwB,CAAU,EAAG,EAC5E3B,EAAS,CACP,KAAM,UACN,MAAO,qBAAA,CACR,CACH,EACA,QAAUO,GAAiB,CACzBP,EAAS,CACP,KAAM,QACN,MAAO,SACP,YAAaO,EAAM,OAAA,CACpB,CACH,CAAA,CACD,EAGKwB,EAAsBlB,EAAY,CACtC,WAAY,MAAOmB,GAAoB,CACrC,GAAI,CAACL,EAAY,MAAM,IAAI,MAAM,sBAAsB,EACvD,MAAMjB,EAAW,MAAMC,EAAI,OACzB,yBAAyBgB,CAAU,IAAIK,CAAO,EAAA,EAEhD,GAAI,CAACtB,EAAS,QACZ,MAAM,IAAI,MAAMA,EAAS,OAAS,wBAAwB,CAE9D,EACA,UAAW,IAAM,CACfP,EAAY,kBAAkB,CAAE,SAAU,CAAC,mBAAoBwB,CAAU,EAAG,EAC5E3B,EAAS,CACP,KAAM,UACN,MAAO,iBAAA,CACR,CACH,EACA,QAAUO,GAAiB,CACzBP,EAAS,CACP,KAAM,QACN,MAAO,SACP,YAAaO,EAAM,OAAA,CACpB,CACH,CAAA,CACD,EAED,MAAO,CACL,OAAQqB,GAAU,CAAA,EAClB,UAAAtB,EACA,MAAAC,EACA,YAAasB,EAAoB,OACjC,WAAYA,EAAoB,UAChC,YAAaE,EAAoB,OACjC,WAAYA,EAAoB,SAAA,CAEpC"}