import{b as P,u as N,c as w,j as e}from"./vendor-query-CpRdniug.js";import{L as z,r as L}from"./vendor-react-4xEIaAEA.js";import{b as K,d as W}from"./index-CupJPaFk.js";import{u as E}from"./useShopify-BNCwXObD.js";import{D as _}from"./DashboardLayout-BZDTWsk4.js";import{a as u}from"./api-DNziMqA2.js";import{L as A,a5 as p,B as F,b as $,a6 as S,a3 as k,r as q,S as D,d as T,Z as Q,O as U,N as C,V,l as B}from"./vendor-ui-BMWb517o.js";import"./vendor-supabase-DejIJ_qE.js";import"./vendor-charts-Cz_1NfFu.js";const M={sales_3d:5,sales_7d:10,sales_10d:15,sales_14d:20,min_buckets:3},R={max_video_campaigns:2,max_image_campaigns:4,video_count:2,image_count:4};function H(s){const t=P(),a=N({queryKey:["winners",s],queryFn:()=>u.get(`/api/pod-autom/winners/${s}`),enabled:!!s,staleTime:1e3*60*2}),i=N({queryKey:["winners","stats",s],queryFn:()=>u.get(`/api/pod-autom/winners/${s}/stats`),enabled:!!s,staleTime:1e3*60*2}),n=N({queryKey:["winners","settings",s],queryFn:()=>u.get(`/api/pod-autom/winners/${s}/settings`),enabled:!!s,staleTime:1e3*60*5}),l=w({mutationFn:({winnerId:o,isActive:d})=>u.post(`/api/pod-autom/winners/${s}/${o}/toggle`,{is_active:d}),onSuccess:()=>{t.invalidateQueries({queryKey:["winners",s]}),t.invalidateQueries({queryKey:["winners","stats",s]})}}),c=w({mutationFn:o=>u.post(`/api/pod-autom/winners/${s}/campaigns/${o}/pause`),onSuccess:()=>{t.invalidateQueries({queryKey:["winners",s]}),t.invalidateQueries({queryKey:["winners","stats",s]})}}),m=w({mutationFn:o=>u.put(`/api/pod-autom/winners/${s}/settings`,o),onSuccess:()=>{t.invalidateQueries({queryKey:["winners","settings",s]})}}),r=a.data?.winners??[],j=i.data?.stats??{total_winners:0,active_winners:0,total_campaigns:0,active_campaigns:0,video_campaigns:0,image_campaigns:0},v=i.data?.recent_activity??[],x=n.data?.settings??null,b=x?.winner_thresholds??M,f=x?.winner_limits??R;return{winners:r,stats:j,recentActivity:v,settings:x,thresholds:b,limits:f,isLoading:a.isLoading||i.isLoading,isLoadingSettings:n.isLoading,error:a.error??i.error??n.error,toggleWinner:l.mutate,isTogglingWinner:l.isPending,pauseCampaign:c.mutate,isPausingCampaign:c.isPending,updateSettings:m.mutate,isUpdatingSettings:m.isPending,refetch:()=>{t.invalidateQueries({queryKey:["winners"]})}}}function g({title:s,value:t,icon:a,trend:i,color:n="violet"}){const l={violet:"bg-violet-500/20 text-violet-400",emerald:"bg-emerald-500/20 text-emerald-400",amber:"bg-amber-500/20 text-amber-400",red:"bg-red-500/20 text-red-400"};return e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-zinc-400",children:s}),e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${l[n]}`,children:a})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:t}),i!==void 0&&e.jsxs("span",{className:`text-sm ${i>=0?"text-emerald-400":"text-red-400"}`,children:[i>=0?"+":"",i,"%"]})]})]})}function O({winner:s,onToggle:t,onPauseCampaign:a,isToggling:i}){const[n,l]=L.useState(!1),c=s.winner_campaigns?.filter(r=>r.status==="ACTIVE")??[],m=s.winner_campaigns?.filter(r=>r.status==="PAUSED")??[];return e.jsxs("div",{className:`bg-zinc-900 rounded-xl border ${s.is_active?"border-zinc-800":"border-zinc-800/50"} overflow-hidden`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg bg-zinc-800 flex-shrink-0 overflow-hidden",children:s.shopify_image_url?e.jsx("img",{src:s.shopify_image_url,alt:s.product_title,loading:"lazy",decoding:"async",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(p,{className:"w-8 h-8 text-zinc-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white truncate",children:s.product_title}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-0.5",children:["Identifiziert: ",new Date(s.identified_at).toLocaleDateString("de-DE")]})]}),e.jsx("button",{onClick:()=>t(s.id,!s.is_active),disabled:i,className:`px-2 py-1 rounded-md text-xs font-medium transition-colors ${s.is_active?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"bg-zinc-700 text-zinc-400 hover:bg-zinc-600"}`,children:s.is_active?"Aktiv":"Pausiert"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(h,{label:"3T",value:s.sales_3d}),e.jsx(h,{label:"7T",value:s.sales_7d}),e.jsx(h,{label:"10T",value:s.sales_10d}),e.jsx(h,{label:"14T",value:s.sales_14d}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md bg-violet-500/20 text-violet-400 text-xs",children:[e.jsx(T,{className:"w-3 h-3"}),s.buckets_passed,"/4"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-zinc-800",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-emerald-400",children:[e.jsx(U,{className:"w-3 h-3"}),c.length," aktiv"]}),e.jsxs("span",{className:"flex items-center gap-1 text-zinc-500",children:[e.jsx(C,{className:"w-3 h-3"}),m.length," pausiert"]})]}),e.jsxs("button",{onClick:()=>l(!n),className:"flex items-center gap-1 text-sm text-zinc-400 hover:text-white transition-colors",children:["Kampagnen",n?e.jsx(V,{className:"w-4 h-4"}):e.jsx(B,{className:"w-4 h-4"})]})]})]}),n&&s.winner_campaigns&&s.winner_campaigns.length>0&&e.jsx("div",{className:"border-t border-zinc-800 bg-zinc-950/50 p-4 space-y-2",children:s.winner_campaigns.map(r=>e.jsx(Z,{campaign:r,onPause:()=>a(r.id)},r.id))}),n&&(!s.winner_campaigns||s.winner_campaigns.length===0)&&e.jsx("div",{className:"border-t border-zinc-800 bg-zinc-950/50 p-4",children:e.jsx("p",{className:"text-sm text-zinc-500 text-center",children:"Keine Kampagnen erstellt. Der naechste Job wird Kampagnen generieren."})})]})}function h({label:s,value:t}){return e.jsxs("div",{className:"flex flex-col items-center px-2 py-1 rounded-md bg-zinc-800 text-xs",children:[e.jsx("span",{className:"text-zinc-500",children:s}),e.jsx("span",{className:"text-white font-medium",children:t})]})}function Z({campaign:s,onPause:t}){const a=s.status==="ACTIVE";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-zinc-900 border border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${s.creative_type==="video"?"bg-red-500/20 text-red-400":"bg-blue-500/20 text-blue-400"}`,children:s.creative_type==="video"?e.jsx(S,{className:"w-4 h-4"}):e.jsx(k,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white truncate max-w-[200px]",children:s.campaign_name}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.creative_type==="video"?"Video":"Bild"," | Link zu ",s.link_type==="product"?"Produkt":"Kollektion"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-zinc-400",children:[s.daily_budget.toFixed(2)," EUR/Tag"]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a?"bg-emerald-500/20 text-emerald-400":"bg-zinc-700 text-zinc-400"}`,children:s.status}),a&&e.jsx("button",{onClick:t,className:"p-1.5 rounded hover:bg-zinc-800 text-zinc-400 hover:text-white transition-colors",title:"Kampagne pausieren",children:e.jsx(C,{className:"w-4 h-4"})})]})]})}function G(){return e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-violet-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"w-8 h-8 text-violet-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Noch keine Winner identifiziert"}),e.jsx("p",{className:"text-zinc-400 mb-6 max-w-md mx-auto",children:"Sobald Produkte die Verkaufsschwellen erreichen, werden sie hier als Winner angezeigt und automatisch skaliert."}),e.jsxs("div",{className:"flex flex-col items-center gap-2 text-sm text-zinc-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-violet-400"}),"AI-generierte Creatives (Bilder & Videos)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-violet-400"}),"Automatische Kampagnen-Erstellung"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-violet-400"}),"A/B Testing mit Produkt & Collection Links"]})]})]})}function J(){return e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-violet-500/30 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-violet-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"w-8 h-8 text-violet-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Premium Feature"}),e.jsx("p",{className:"text-zinc-400 mb-6 max-w-md mx-auto",children:"Winner Scaling ist nur im Premium- und VIP-Tarif verfuegbar. Upgrade jetzt, um Top-Performer automatisch zu skalieren."}),e.jsx(z,{to:"/pricing",className:"btn-primary",children:"Auf Premium upgraden"})]})}function re(){const{shops:s,isLoading:t}=E(),{canUseFeature:a}=K(),{addToast:i}=W(),n=s[0]?.id??null,{winners:l,stats:c,isLoading:m,toggleWinner:r,isTogglingWinner:j,pauseCampaign:v}=H(n),x=a("winnerScaling"),b=t||m,f=(d,y)=>{r({winnerId:d,isActive:y},{onSuccess:()=>{i(y?"Winner aktiviert":"Winner pausiert","success")},onError:()=>{i("Fehler beim Aktualisieren","error")}})},o=d=>{v(d,{onSuccess:()=>{i("Kampagne pausiert","success")},onError:()=>{i("Fehler beim Pausieren","error")}})};return b?e.jsx(_,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(A,{className:"w-8 h-8 text-violet-500 animate-spin"})})}):e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-violet-400"}),"Winner Scaling"]}),e.jsx("p",{className:"text-zinc-400 mt-1",children:"Automatische Skalierung deiner Top-Performer"})]}),e.jsxs(z,{to:"/settings",className:"btn-secondary flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Einstellungen"]})]}),!x&&e.jsx(J,{}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(g,{title:"Winner Produkte",value:c.total_winners,icon:e.jsx(p,{className:"w-4 h-4"}),color:"violet"}),e.jsx(g,{title:"Aktive Winner",value:c.active_winners,icon:e.jsx($,{className:"w-4 h-4"}),color:"emerald"}),e.jsx(g,{title:"Video Kampagnen",value:c.video_campaigns,icon:e.jsx(S,{className:"w-4 h-4"}),color:"amber"}),e.jsx(g,{title:"Bild Kampagnen",value:c.image_campaigns,icon:e.jsx(k,{className:"w-4 h-4"}),color:"violet"})]}),l.length===0?e.jsx(G,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Winner Produkte (",l.length,")"]}),e.jsx("div",{className:"grid gap-4",children:l.map(d=>e.jsx(O,{winner:d,onToggle:f,onPauseCampaign:o,isToggling:j},d.id))})]})]})]})})}export{re as default};
//# sourceMappingURL=DashboardWinners-Dv1IxnBh.js.map
