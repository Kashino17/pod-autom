import{j as e,b as k,u as D,c as w}from"./vendor-query-CpRdniug.js";import{r as f}from"./vendor-react-4xEIaAEA.js";import{u as F,a as T}from"./index-DMzOI_GZ.js";import{u as L}from"./useShopify-D96WEgLm.js";import{D as v}from"./DashboardLayout-CmF7xzGu.js";import{L as p,m as N,n as E,F as Q,l as M,T as A,a4 as I,s as K,a0 as O,Q as y,C as W,a as $,a1 as R,S as B,a3 as U,h as V}from"./vendor-ui-BMWb517o.js";import{a as j}from"./api-DZjOEeDy.js";import"./vendor-supabase-DejIJ_qE.js";import"./vendor-charts-Cz_1NfFu.js";const G={pending:{label:"Wartend",icon:e.jsx(V,{className:"w-4 h-4"}),color:"text-zinc-400",bgColor:"bg-zinc-500/20"},generating:{label:"Bild wird erstellt",icon:e.jsx(U,{className:"w-4 h-4"}),color:"text-blue-400",bgColor:"bg-blue-500/20"},optimizing:{label:"Wird optimiert",icon:e.jsx(B,{className:"w-4 h-4"}),color:"text-violet-400",bgColor:"bg-violet-500/20"},publishing:{label:"Wird veröffentlicht",icon:e.jsx(R,{className:"w-4 h-4"}),color:"text-amber-400",bgColor:"bg-amber-500/20"},published:{label:"Veröffentlicht",icon:e.jsx($,{className:"w-4 h-4"}),color:"text-emerald-400",bgColor:"bg-emerald-500/20"},failed:{label:"Fehlgeschlagen",icon:e.jsx(W,{className:"w-4 h-4"}),color:"text-red-400",bgColor:"bg-red-500/20"}},z=[{value:"all",label:"Alle"},{value:"pending",label:"Wartend"},{value:"generating",label:"Wird erstellt"},{value:"optimizing",label:"Wird optimiert"},{value:"publishing",label:"Wird veröffentlicht"},{value:"published",label:"Veröffentlicht"},{value:"failed",label:"Fehlgeschlagen"}];function _({product:t,onRetry:r,onDelete:s,onView:d}){const n=G[t.status],c=["generating","optimizing","publishing"].includes(t.status),x=o=>{const u=new Date(o);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(u)};return e.jsxs("div",{className:"bg-zinc-800/50 rounded-xl border border-zinc-700 overflow-hidden hover:border-zinc-600 transition-colors",children:[e.jsxs("div",{className:"aspect-square bg-zinc-900 relative",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.title,loading:"lazy",decoding:"async",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(N,{className:"w-12 h-12 text-zinc-700"})}),e.jsxs("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-lg flex items-center gap-1.5 text-xs font-medium ${n.bgColor} ${n.color}`,children:[c?e.jsx(p,{className:"w-3 h-3 animate-spin"}):n.icon,n.label]}),c&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-zinc-800",children:e.jsx("div",{className:"h-full bg-violet-500 transition-all duration-300",style:{width:`${t.progress}%`}})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-white truncate",title:t.title,children:t.title||"Neues Produkt"}),e.jsxs("p",{className:"text-sm text-zinc-500 mt-1",children:[t.niche," · ",x(t.updatedAt)]}),t.currentStep&&c&&e.jsxs("p",{className:"text-xs text-violet-400 mt-2 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3 animate-spin"}),t.currentStep]}),t.status==="failed"&&t.error&&e.jsxs("p",{className:"text-xs text-red-400 mt-2 flex items-start gap-1",children:[e.jsx(A,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:t.error})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-zinc-700",children:[t.status==="published"&&t.shopifyUrl&&e.jsxs("a",{href:t.shopifyUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1 btn-secondary text-xs justify-center",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Shopify"]}),t.status==="published"&&e.jsxs("button",{onClick:d,className:"flex-1 btn-secondary text-xs justify-center",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Details"]}),t.status==="failed"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:r,className:"flex-1 btn-secondary text-xs justify-center",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Erneut"]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",children:e.jsx(y,{className:"w-3 h-3"})})]}),t.status==="pending"&&e.jsxs("button",{onClick:s,className:"flex-1 btn-secondary text-xs justify-center text-red-400 hover:text-red-300",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Entfernen"]})]})]})]})}function q({products:t}){const r={total:t.length,pending:t.filter(s=>s.status==="pending").length,processing:t.filter(s=>["generating","optimizing","publishing"].includes(s.status)).length,published:t.filter(s=>s.status==="published").length,failed:t.filter(s=>s.status==="failed").length};return e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"bg-zinc-800/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:r.total}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Gesamt"})]}),e.jsxs("div",{className:"bg-zinc-800/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-zinc-400",children:r.pending}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Wartend"})]}),e.jsxs("div",{className:"bg-zinc-800/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-violet-400",children:r.processing}),e.jsx("p",{className:"text-xs text-zinc-500",children:"In Arbeit"})]}),e.jsxs("div",{className:"bg-zinc-800/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:r.published}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Veröffentlicht"})]}),e.jsxs("div",{className:"bg-zinc-800/50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:r.failed}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Fehlgeschlagen"})]})]})}function H({products:t,isLoading:r,onRetry:s,onDelete:d,onView:n}){const[c,x]=f.useState(""),[o,u]=f.useState("all"),[i,a]=f.useState(!1),m=[...t.filter(l=>{const b=l.title.toLowerCase().includes(c.toLowerCase())||l.niche.toLowerCase().includes(c.toLowerCase()),g=o==="all"||l.status===o;return b&&g})].sort((l,b)=>{const g={generating:0,optimizing:1,publishing:2,pending:3,published:4,failed:5};return g[l.status]-g[b.status]});return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(p,{className:"w-8 h-8 text-violet-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-violet-400"}),"Produkt-Pipeline"]}),e.jsx("p",{className:"text-sm text-zinc-400 mt-1",children:"Übersicht aller Produkte in der Erstellungs-Queue"})]})}),e.jsx(q,{products:t}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),e.jsx("input",{type:"text",value:c,onChange:l=>x(l.target.value),className:"input pl-10 w-full",placeholder:"Produkte suchen..."})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>a(!i),className:"btn-secondary w-full sm:w-auto justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),z.find(l=>l.value===o)?.label]}),e.jsx(M,{className:"w-4 h-4 ml-2"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-zinc-800 border border-zinc-700 rounded-lg shadow-xl z-20 overflow-hidden",children:z.map(l=>e.jsx("button",{onClick:()=>{u(l.value),a(!1)},className:`w-full px-4 py-2 text-left text-sm transition-colors ${o===l.value?"bg-violet-500/20 text-violet-300":"text-zinc-300 hover:bg-zinc-700"}`,children:l.label},l.value))})]})]})]}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:m.map(l=>e.jsx(_,{product:l,onRetry:()=>s(l.id),onDelete:()=>d(l.id),onView:()=>n(l.id)},l.id))}):e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-8 h-8 text-zinc-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:c||o!=="all"?"Keine Produkte gefunden":"Keine Produkte in der Queue"}),e.jsx("p",{className:"text-zinc-400",children:c||o!=="all"?"Versuche andere Filteroptionen.":"Produkte werden automatisch erstellt basierend auf deinen Nischen."})]})]})}const S=["Fitness","Gaming","Haustiere","Reisen","Kochen"],P=["Motivations-Shirt für Sportler","Gaming Legend T-Shirt","Hundeliebhaber Hoodie","Wanderlust Reise-Shirt","Chef Life Kochschürze","Gym Motivation Tank Top","Pro Gamer Hoodie","Katzenfreund T-Shirt","Adventure Awaits Shirt","Kitchen Boss Schürze"],X={generating:["Prompt wird verarbeitet...","Bild wird generiert...","Qualitätsprüfung..."],optimizing:["Titel wird optimiert...","Beschreibung wird erstellt...","SEO-Analyse..."],publishing:["Produkt wird erstellt...","Bild wird hochgeladen...","Wird veröffentlicht..."]};function C(){const t=[],r=["pending","generating","optimizing","publishing","published","failed"];for(let s=0;s<12;s++){const d=s%r.length,n=r[d]??"pending",c=s%S.length,x=S[c]??"Fitness",o=s%P.length,u=P[o]??"Neues Produkt",i=["generating","optimizing","publishing"].includes(n);let a;if(i&&(n==="generating"||n==="optimizing"||n==="publishing")){const h=X[n],m=Math.floor(Math.random()*h.length);a=h[m]}t.push({id:`prod-${s+1}`,title:n==="pending"?"":u,niche:x,imageUrl:n!=="pending"&&n!=="generating"?`https://picsum.photos/seed/${s+1}/400/400`:void 0,status:n,progress:i?Math.floor(Math.random()*80)+10:n==="published"?100:0,currentStep:a,shopifyUrl:n==="published"?`https://example.myshopify.com/admin/products/${1e3+s}`:void 0,error:n==="failed"?"Bildgenerierung fehlgeschlagen: API-Limit erreicht":void 0,createdAt:new Date(Date.now()-(s+1)*60*60*1e3).toISOString(),updatedAt:new Date(Date.now()-s*30*60*1e3).toISOString()})}return t}function J(t){const{session:r}=F(),s=T(i=>i.addToast),d=k(),{data:n,isLoading:c,error:x}=D({queryKey:["productQueue",t],queryFn:async()=>{if(!t)return C();try{return(await j.get(`/api/pod-autom/products/${t}/queue`)).products}catch{return C()}},enabled:!!r,staleTime:1e3*30,refetchInterval:1e3*60}),o=w({mutationFn:async i=>{if(!t)return{productId:i};const a=await j.post(`/api/pod-autom/products/${i}/retry`);if(!a.success)throw new Error(a.error||"Retry failed");return{productId:i}},onSuccess:({productId:i})=>{d.setQueryData(["productQueue",t],a=>a?.map(h=>h.id===i?{...h,status:"pending",error:void 0,progress:0}:h)||[]),s({type:"success",title:"Erneuter Versuch gestartet",description:"Das Produkt wurde zur Queue hinzugefügt."})},onError:i=>{s({type:"error",title:"Fehler",description:i.message})}}),u=w({mutationFn:async i=>{if(!t)return{productId:i};const a=await j.delete(`/api/pod-autom/products/${i}`);if(!a.success)throw new Error(a.error||"Delete failed");return{productId:i}},onSuccess:({productId:i})=>{d.setQueryData(["productQueue",t],a=>a?.filter(h=>h.id!==i)||[]),s({type:"success",title:"Produkt entfernt",description:"Das Produkt wurde aus der Queue entfernt."})},onError:i=>{s({type:"error",title:"Fehler",description:i.message})}});return{products:n||[],isLoading:c,error:x,retryProduct:o.mutate,isRetrying:o.isPending,deleteProduct:u.mutate,isDeleting:u.isPending}}function Y({productId:t,onClose:r}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-zinc-900 border border-zinc-800 rounded-2xl p-6 shadow-xl",children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-zinc-400 hover:text-white",children:"✕"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Produkt-Details"}),e.jsxs("p",{className:"text-zinc-400",children:["Produkt-ID: ",t]}),e.jsx("p",{className:"text-zinc-500 mt-4 text-sm",children:"Detailansicht wird in Phase 4 implementiert."})]})]}):null}function ce(){const{shops:t,isLoading:r}=L(),s=t[0]?.id||null,[d,n]=f.useState(null),{products:c,isLoading:x,retryProduct:o,deleteProduct:u}=J(s),i=r||x;return i?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(p,{className:"w-8 h-8 text-violet-500 animate-spin"})})}):e.jsxs(v,{children:[e.jsx(H,{products:c,isLoading:i,onRetry:o,onDelete:u,onView:a=>n(a)}),e.jsx(Y,{productId:d,onClose:()=>n(null)})]})}export{ce as default};
//# sourceMappingURL=DashboardProducts-C8CGnGkn.js.map
