{"version":3,"file":"usePinterest-DC43FXi5.js","sources":["../../src/hooks/usePinterest.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@src/contexts/AuthContext'\nimport { api } from '@src/lib/api'\n\n// =====================================================\n// TYPES\n// =====================================================\n\nexport interface PinterestPlatform {\n  id: string\n  platform_user_id: string | null\n  platform_username: string | null\n  ad_account_id: string | null\n  ad_account_name: string | null\n  connection_status: 'connected' | 'disconnected' | 'error' | 'expired'\n  token_expires_at: string | null\n  last_sync_at: string | null\n}\n\nexport interface PinterestAdAccount {\n  id: string\n  name: string\n  country: string\n  currency: string\n}\n\nexport interface PinterestBoard {\n  id: string\n  name: string\n  description: string | null\n  privacy: 'PUBLIC' | 'SECRET' | 'PROTECTED'\n  pin_count: number\n}\n\ninterface StatusResponse {\n  success: boolean\n  connected: boolean\n  platform: PinterestPlatform | null\n}\n\ninterface AdAccountsResponse {\n  success: boolean\n  ad_accounts: PinterestAdAccount[]\n}\n\ninterface BoardsResponse {\n  success: boolean\n  boards: PinterestBoard[]\n}\n\n// =====================================================\n// HOOK\n// =====================================================\n\nexport function usePinterest() {\n  const { user } = useAuth()\n  const queryClient = useQueryClient()\n  const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:5001'\n\n  // Get Pinterest connection status\n  const statusQuery = useQuery({\n    queryKey: ['pinterest', 'status', user?.id],\n    queryFn: () => api.get<StatusResponse>('/api/pod-autom/pinterest/status'),\n    enabled: !!user,\n    staleTime: 1000 * 60 * 2, // 2 minutes\n  })\n\n  // Get ad accounts\n  const adAccountsQuery = useQuery({\n    queryKey: ['pinterest', 'ad-accounts', user?.id],\n    queryFn: () => api.get<AdAccountsResponse>('/api/pod-autom/pinterest/ad-accounts'),\n    enabled: !!user && statusQuery.data?.connected === true,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  })\n\n  // Get boards\n  const boardsQuery = useQuery({\n    queryKey: ['pinterest', 'boards', user?.id],\n    queryFn: () => api.get<BoardsResponse>('/api/pod-autom/pinterest/boards'),\n    enabled: !!user && statusQuery.data?.connected === true,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  })\n\n  // Connect Pinterest (redirect to OAuth)\n  const connect = () => {\n    if (!user) return\n    window.location.href = `${apiUrl}/api/pod-autom/pinterest/authorize?user_id=${user.id}`\n  }\n\n  // Disconnect Pinterest\n  const disconnectMutation = useMutation({\n    mutationFn: () => api.post<{ success: boolean }>('/api/pod-autom/pinterest/disconnect'),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pinterest'] })\n    },\n  })\n\n  // Select ad account\n  const selectAdAccountMutation = useMutation({\n    mutationFn: (data: { ad_account_id: string; ad_account_name: string }) =>\n      api.post<{ success: boolean }>('/api/pod-autom/pinterest/select-ad-account', data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['pinterest', 'status'] })\n    },\n  })\n\n  return {\n    // Status\n    isConnected: statusQuery.data?.connected ?? false,\n    platform: statusQuery.data?.platform ?? null,\n    isLoading: statusQuery.isLoading,\n    error: statusQuery.error,\n\n    // Ad Accounts\n    adAccounts: adAccountsQuery.data?.ad_accounts ?? [],\n    adAccountsLoading: adAccountsQuery.isLoading,\n    refetchAdAccounts: adAccountsQuery.refetch,\n\n    // Boards\n    boards: boardsQuery.data?.boards ?? [],\n    boardsLoading: boardsQuery.isLoading,\n    refetchBoards: boardsQuery.refetch,\n\n    // Actions\n    connect,\n    disconnect: disconnectMutation.mutate,\n    isDisconnecting: disconnectMutation.isPending,\n\n    selectAdAccount: selectAdAccountMutation.mutate,\n    isSelectingAdAccount: selectAdAccountMutation.isPending,\n\n    // Refetch\n    refetch: () => {\n      queryClient.invalidateQueries({ queryKey: ['pinterest'] })\n    },\n  }\n}\n"],"names":["usePinterest","user","useAuth","queryClient","useQueryClient","apiUrl","statusQuery","useQuery","api","adAccountsQuery","boardsQuery","connect","disconnectMutation","useMutation","selectAdAccountMutation","data"],"mappings":"sIAsDO,SAASA,GAAe,CAC7B,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACXC,EAAcC,EAAA,EACdC,EAAS,wBAGTC,EAAcC,EAAS,CAC3B,SAAU,CAAC,YAAa,SAAUN,GAAM,EAAE,EAC1C,QAAS,IAAMO,EAAI,IAAoB,iCAAiC,EACxE,QAAS,CAAC,CAACP,EACX,UAAW,IAAO,GAAK,CAAA,CACxB,EAGKQ,EAAkBF,EAAS,CAC/B,SAAU,CAAC,YAAa,cAAeN,GAAM,EAAE,EAC/C,QAAS,IAAMO,EAAI,IAAwB,sCAAsC,EACjF,QAAS,CAAC,CAACP,GAAQK,EAAY,MAAM,YAAc,GACnD,UAAW,IAAO,GAAK,CAAA,CACxB,EAGKI,EAAcH,EAAS,CAC3B,SAAU,CAAC,YAAa,SAAUN,GAAM,EAAE,EAC1C,QAAS,IAAMO,EAAI,IAAoB,iCAAiC,EACxE,QAAS,CAAC,CAACP,GAAQK,EAAY,MAAM,YAAc,GACnD,UAAW,IAAO,GAAK,CAAA,CACxB,EAGKK,EAAU,IAAM,CACfV,IACL,OAAO,SAAS,KAAO,GAAGI,CAAM,8CAA8CJ,EAAK,EAAE,GACvF,EAGMW,EAAqBC,EAAY,CACrC,WAAY,IAAML,EAAI,KAA2B,qCAAqC,EACtF,UAAW,IAAM,CACfL,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,EAAG,CAC3D,CAAA,CACD,EAGKW,EAA0BD,EAAY,CAC1C,WAAaE,GACXP,EAAI,KAA2B,6CAA8CO,CAAI,EACnF,UAAW,IAAM,CACfZ,EAAY,kBAAkB,CAAE,SAAU,CAAC,YAAa,QAAQ,EAAG,CACrE,CAAA,CACD,EAED,MAAO,CAEL,YAAaG,EAAY,MAAM,WAAa,GAC5C,SAAUA,EAAY,MAAM,UAAY,KACxC,UAAWA,EAAY,UACvB,MAAOA,EAAY,MAGnB,WAAYG,EAAgB,MAAM,aAAe,CAAA,EACjD,kBAAmBA,EAAgB,UACnC,kBAAmBA,EAAgB,QAGnC,OAAQC,EAAY,MAAM,QAAU,CAAA,EACpC,cAAeA,EAAY,UAC3B,cAAeA,EAAY,QAG3B,QAAAC,EACA,WAAYC,EAAmB,OAC/B,gBAAiBA,EAAmB,UAEpC,gBAAiBE,EAAwB,OACzC,qBAAsBA,EAAwB,UAG9C,QAAS,IAAM,CACbX,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,EAAG,CAC3D,CAAA,CAEJ"}