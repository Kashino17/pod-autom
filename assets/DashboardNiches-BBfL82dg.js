import{j as e,b as O,u as Q,c as C}from"./vendor-query-CpRdniug.js";import{b as G,u as V,a as J,s as w}from"./index-BNM9HcXn.js";import{r as z,L as F}from"./vendor-react-4xEIaAEA.js";import{u as H,a as W}from"./useShopify-Bi_TIP8F.js";import{D as T}from"./DashboardLayout-C89MhE5p.js";import{L as A,G as _,J as y,r as P,A as Y,n as B,X,S as Z,K as ee,N as se,O as te,Q as re,s as ae,t as ie,b as ne,w as ce}from"./vendor-ui-BMWb517o.js";import"./vendor-supabase-DejIJ_qE.js";import"./vendor-charts-Cz_1NfFu.js";import"./api-BF1n4RIP.js";const le=[{name:"Fitness & Sport",icon:"ðŸ’ª"},{name:"Haustiere",icon:"ðŸ•"},{name:"Gaming",icon:"ðŸŽ®"},{name:"Musik",icon:"ðŸŽµ"},{name:"Reisen",icon:"âœˆï¸"},{name:"Kochen",icon:"ðŸ‘¨â€ðŸ³"},{name:"Fotografie",icon:"ðŸ“·"},{name:"Yoga",icon:"ðŸ§˜"}];function oe({niche:s,onToggle:N,onDelete:c}){const[d,i]=z.useState(!1),m=u=>new Intl.NumberFormat("de-DE").format(u),l=u=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(u);return e.jsxs("div",{className:`relative bg-zinc-800/50 rounded-xl border transition-all ${s.isActive?"border-violet-500/30 hover:border-violet-500/50":"border-zinc-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between p-4 border-b border-zinc-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s.isActive?"bg-violet-500/20":"bg-zinc-700"}`,children:e.jsx(_,{className:`w-5 h-5 ${s.isActive?"text-violet-400":"text-zinc-500"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:s.name}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.isActive?"Aktiv":"Pausiert"," Â· ",s.productCount," Produkte"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!d),className:"p-1.5 rounded-lg hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors",children:e.jsx(ee,{className:"w-4 h-4"})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-40 bg-zinc-800 border border-zinc-700 rounded-lg shadow-xl z-20 overflow-hidden",children:[e.jsx("button",{onClick:()=>{N(!s.isActive),i(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700 transition-colors",children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4"}),"Pausieren"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Aktivieren"]})}),e.jsxs("button",{onClick:()=>{c(),i(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-zinc-700 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),"LÃ¶schen"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 divide-x divide-zinc-700/50",children:[e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 text-zinc-400 mb-1",children:e.jsx(ae,{className:"w-3.5 h-3.5"})}),e.jsx("p",{className:"text-sm font-medium text-white",children:m(s.impressions)}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Impressionen"})]}),e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 text-zinc-400 mb-1",children:e.jsx(ie,{className:"w-3.5 h-3.5"})}),e.jsx("p",{className:"text-sm font-medium text-white",children:s.sales}),e.jsx("p",{className:"text-xs text-zinc-500",children:"VerkÃ¤ufe"})]}),e.jsxs("div",{className:"p-3 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[s.trend==="up"&&e.jsx(ne,{className:"w-3.5 h-3.5 text-emerald-400"}),s.trend==="down"&&e.jsx(ce,{className:"w-3.5 h-3.5 text-red-400"}),s.trend==="neutral"&&e.jsx("div",{className:"w-3.5 h-0.5 bg-zinc-600 rounded"})]}),e.jsx("p",{className:"text-sm font-medium text-white",children:l(s.revenue)}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Umsatz"})]})]})]})}function de({niches:s,isLoading:N,onAddNiche:c,onToggleNiche:d,onDeleteNiche:i,isAdding:m=!1}){const[l,u]=z.useState(""),[x,g]=z.useState(""),[j,t]=z.useState(!1),{maxNiches:r,tier:n,isActive:o}=G(),h=s.filter(a=>a.name.toLowerCase().includes(l.toLowerCase())),f=s.filter(a=>a.isActive).length,$=s.reduce((a,p)=>a+p.productCount,0),R=s.reduce((a,p)=>a+p.revenue,0),b=r===1/0,q=o&&(b||s.length<r),S=!b&&s.length>=r,k=!b&&s.length>=r*.8,E=a=>{!a.trim()||s.some(K=>K.name.toLowerCase()===a.toLowerCase())||(c(a.trim()),g(""),t(!1))},I=a=>{a.preventDefault(),E(x)},D=le.filter(a=>!s.some(p=>p.name.toLowerCase()===a.name.toLowerCase()));return N?e.jsx("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx(A,{className:"w-8 h-8 text-violet-500 animate-spin"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-violet-400"}),"Nischen",!b&&e.jsxs("span",{className:`text-sm font-normal px-2 py-0.5 rounded-full ${S?"bg-red-500/20 text-red-400":k?"bg-amber-500/20 text-amber-400":"bg-zinc-700 text-zinc-400"}`,children:[s.length,"/",r]})]}),e.jsxs("p",{className:"text-sm text-zinc-400 mt-1",children:[f," aktiv Â· ",$," Produkte Â· ",new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(R)," Umsatz"]})]}),q?e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Nische hinzufÃ¼gen"]}):S?e.jsxs(F,{to:`/checkout?tier=${n==="basis"?"premium":"vip"}`,className:"btn-primary",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Upgrade fuer mehr Nischen"]}):e.jsxs("button",{disabled:!0,className:"btn-secondary opacity-50 cursor-not-allowed",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Nische hinzufÃ¼gen"]})]}),S&&e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-200 font-medium",children:"Nischen-Limit erreicht"}),e.jsxs("p",{className:"text-sm text-amber-300/70",children:["Upgrade auf ",n==="basis"?"Premium":"VIP"," fuer ",n==="basis"?"15":"unbegrenzte"," Nischen."]})]})]}),e.jsxs(F,{to:`/checkout?tier=${n==="basis"?"premium":"vip"}`,className:"flex items-center gap-1 text-amber-400 hover:text-amber-300 text-sm font-medium transition-colors",children:["Upgraden",e.jsx(Y,{className:"w-4 h-4"})]})]})}),s.length>4&&e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),e.jsx("input",{type:"text",value:l,onChange:a=>u(a.target.value),className:"input pl-10",placeholder:"Nischen durchsuchen..."})]}),h.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(a=>e.jsx(oe,{niche:a,onToggle:p=>d(a.id,p),onDelete:()=>i(a.id)},a.id))}):e.jsxs("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(_,{className:"w-8 h-8 text-zinc-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:l?"Keine Nischen gefunden":"Keine Nischen vorhanden"}),e.jsx("p",{className:"text-zinc-400 mb-4",children:l?"Versuche einen anderen Suchbegriff.":"FÃ¼ge deine erste Nische hinzu, um loszulegen."}),!l&&e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Erste Nische hinzufÃ¼gen"]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>t(!1)}),e.jsxs("div",{className:"relative w-full max-w-md bg-zinc-900 border border-zinc-800 rounded-2xl p-6 shadow-xl",children:[e.jsx("button",{onClick:()=>t(!1),className:"absolute top-4 right-4 text-zinc-400 hover:text-white",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Nische hinzufÃ¼gen"}),e.jsxs("p",{className:"text-sm text-zinc-400 mt-1",children:["WÃ¤hle eine Nische fÃ¼r die Produkt-Erstellung.",!b&&e.jsxs("span",{className:`ml-2 ${k?"text-amber-400":""}`,children:["(",s.length,"/",r," verwendet)"]})]})]}),e.jsxs("form",{onSubmit:I,className:"mb-6",children:[e.jsx("label",{className:"label",children:"Eigene Nische"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:a=>g(a.target.value),className:"input flex-1",placeholder:"z.B. Wandern, Camping, ..."}),e.jsx("button",{type:"submit",disabled:!x.trim()||m,className:"btn-primary px-4",children:m?e.jsx(A,{className:"w-5 h-5 animate-spin"}):e.jsx(y,{className:"w-5 h-5"})})]})]}),D.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"label flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"VorschlÃ¤ge"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:D.slice(0,6).map(a=>e.jsxs("button",{onClick:()=>E(a.name),disabled:m,className:"flex items-center gap-2 p-3 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-300 hover:text-white text-sm transition-colors text-left",children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("span",{children:a.name})]},a.name))})]})]})]})]})}const M="pod_autom_niches_demo";function v(){try{const s=localStorage.getItem(M);return s?JSON.parse(s):[]}catch{return[]}}function L(s){localStorage.setItem(M,JSON.stringify(s))}function U(s){return{id:s.id,name:s.niche_name,slug:s.niche_slug||"",isActive:s.is_active??!0,productCount:s.total_products??0,impressions:0,sales:s.total_sales??0,revenue:parseFloat(s.total_revenue)||0,trend:"neutral",createdAt:s.created_at}}function me(s){const{session:N}=V(),c=J(t=>t.addToast),d=O(),i=!s||!N,{data:m,isLoading:l,error:u}=Q({queryKey:["niche-stats",s,i],queryFn:async()=>{if(i)return v();const{data:t,error:r}=await w.from("pod_autom_niches").select("*").eq("settings_id",s).order("created_at",{ascending:!1});return r?(console.error("Error fetching niches:",r),v()):t.map(U)},enabled:!0,staleTime:1e3*60*5}),x=C({mutationFn:async t=>{const r={id:crypto.randomUUID(),name:t,slug:t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),isActive:!0,productCount:0,impressions:0,sales:0,revenue:0,trend:"neutral",createdAt:new Date().toISOString()};if(i){const h=v(),f=[r,...h];return L(f),r}const{data:n,error:o}=await w.from("pod_autom_niches").insert({settings_id:s,niche_name:t,is_active:!0}).select().single();if(o)throw new Error(o.message);return U(n)},onSuccess:t=>{d.setQueryData(["niche-stats",s,i],r=>[t,...r||[]]),c({type:"success",title:"Nische hinzugefÃ¼gt",description:`${t.name} wurde erfolgreich erstellt.`})},onError:t=>{c({type:"error",title:"Fehler",description:t.message})}}),g=C({mutationFn:async({id:t,active:r})=>{if(i){const h=v().map(f=>f.id===t?{...f,isActive:r}:f);return L(h),{id:t,active:r}}const{error:n}=await w.from("pod_autom_niches").update({is_active:r}).eq("id",t);if(n)throw new Error(n.message);return{id:t,active:r}},onSuccess:({id:t,active:r})=>{d.setQueryData(["niche-stats",s,i],n=>n?.map(o=>o.id===t?{...o,isActive:r}:o)||[]),c({type:"success",title:r?"Nische aktiviert":"Nische pausiert"})},onError:t=>{c({type:"error",title:"Fehler",description:t.message})}}),j=C({mutationFn:async t=>{if(i){const o=v().filter(h=>h.id!==t);return L(o),t}const{error:r}=await w.from("pod_autom_niches").delete().eq("id",t);if(r)throw new Error(r.message);return t},onSuccess:t=>{d.setQueryData(["niche-stats",s,i],r=>r?.filter(n=>n.id!==t)||[]),c({type:"success",title:"Nische gelÃ¶scht"})},onError:t=>{c({type:"error",title:"Fehler",description:t.message})}});return{niches:m||[],isLoading:l,error:u,isDemo:i,addNiche:x.mutate,isAdding:x.isPending,toggleNiche:(t,r)=>g.mutate({id:t,active:r}),isToggling:g.isPending,deleteNiche:j.mutate,isDeleting:j.isPending}}function ve(){const{shops:s,isLoading:N}=H(),c=s[0]?.id||null,{settings:d,isLoading:i}=W(c),{niches:m,isLoading:l,addNiche:u,isAdding:x,toggleNiche:g,deleteNiche:j}=me(d?.id||null),t=N||i||l;return t?e.jsx(T,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(A,{className:"w-8 h-8 text-violet-500 animate-spin"})})}):e.jsx(T,{children:e.jsx(de,{niches:m,isLoading:t,onAddNiche:u,onToggleNiche:g,onDeleteNiche:j,isAdding:x})})}export{ve as default};
//# sourceMappingURL=DashboardNiches-BBfL82dg.js.map
