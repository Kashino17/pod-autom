{"version":3,"file":"useCheckout-pGyrFP0P.js","sources":["../../src/hooks/useCheckout.ts"],"sourcesContent":["import { useState } from 'react'\nimport { api } from '@src/lib/api'\nimport { useAuth } from '@src/contexts/AuthContext'\nimport {\n  STRIPE_PUBLIC_KEY,\n  STRIPE_PRICES,\n  CHECKOUT_SUCCESS_URL,\n  CHECKOUT_CANCEL_URL,\n  type SubscriptionTier,\n} from '@src/lib/constants'\n\n// =====================================================\n// TYPES\n// =====================================================\n\ninterface CheckoutSessionResponse {\n  success: boolean\n  url: string\n  session_id: string\n}\n\ninterface PortalSessionResponse {\n  success: boolean\n  url: string\n}\n\n// =====================================================\n// HOOK\n// =====================================================\n\nexport function useCheckout() {\n  const { user } = useAuth()\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  /**\n   * Creates a Stripe Checkout session and redirects to payment\n   */\n  const createCheckoutSession = async (tier: SubscriptionTier) => {\n    if (!user) {\n      setError('Du musst eingeloggt sein')\n      return\n    }\n\n    if (!STRIPE_PUBLIC_KEY) {\n      setError('Stripe ist nicht konfiguriert')\n      return\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const priceId = STRIPE_PRICES[tier]\n\n      const response = await api.post<CheckoutSessionResponse>('/api/stripe/create-checkout', {\n        price_id: priceId,\n        user_id: user.id,\n        success_url: CHECKOUT_SUCCESS_URL,\n        cancel_url: CHECKOUT_CANCEL_URL,\n      })\n\n      if (response.success && response.url) {\n        // Redirect to Stripe Checkout\n        window.location.href = response.url\n      } else {\n        throw new Error('Checkout-Session konnte nicht erstellt werden')\n      }\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Unbekannter Fehler'\n      setError(message)\n      console.error('Checkout error:', err)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  /**\n   * Opens Stripe Customer Portal for subscription management\n   */\n  const openCustomerPortal = async () => {\n    if (!user) {\n      setError('Du musst eingeloggt sein')\n      return\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const response = await api.post<PortalSessionResponse>('/api/stripe/portal', {\n        user_id: user.id,\n        return_url: `${window.location.origin}/settings`,\n      })\n\n      if (response.success && response.url) {\n        // Redirect to Stripe Portal\n        window.location.href = response.url\n      } else {\n        throw new Error('Portal-Session konnte nicht erstellt werden')\n      }\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Unbekannter Fehler'\n      setError(message)\n      console.error('Portal error:', err)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return {\n    // State\n    isLoading,\n    error,\n    isStripeConfigured: !!STRIPE_PUBLIC_KEY,\n\n    // Actions\n    createCheckoutSession,\n    openCustomerPortal,\n\n    // Helpers\n    clearError: () => setError(null),\n  }\n}\n"],"names":["useCheckout","user","useAuth","isLoading","setIsLoading","useState","error","setError","tier","response","api","err","message"],"mappings":"6HA8BO,SAASA,GAAc,CAC5B,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACX,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAwB,IAAI,EA6EtD,MAAO,CAEL,UAAAF,EACA,MAAAG,EACA,mBAAoB,GAGpB,sBA/E4B,MAAOE,GAA2B,CAC9D,GAAI,CAACP,EAAM,CACTM,EAAS,0BAA0B,EACnC,MACF,CAEwB,CACtBA,EAAS,+BAA+B,EACxC,MACF,CA4BF,EA2CE,mBAtCyB,SAAY,CACrC,GAAI,CAACN,EAAM,CACTM,EAAS,0BAA0B,EACnC,MACF,CAEAH,EAAa,EAAI,EACjBG,EAAS,IAAI,EAEb,GAAI,CACF,MAAME,EAAW,MAAMC,EAAI,KAA4B,qBAAsB,CAC3E,QAAST,EAAK,GACd,WAAY,GAAG,OAAO,SAAS,MAAM,WAAA,CACtC,EAED,GAAIQ,EAAS,SAAWA,EAAS,IAE/B,OAAO,SAAS,KAAOA,EAAS,QAEhC,OAAM,IAAI,MAAM,6CAA6C,CAEjE,OAASE,EAAK,CACZ,MAAMC,EAAUD,aAAe,MAAQA,EAAI,QAAU,qBACrDJ,EAASK,CAAO,EAChB,QAAQ,MAAM,gBAAiBD,CAAG,CACpC,QAAA,CACEP,EAAa,EAAK,CACpB,CACF,EAaE,WAAY,IAAMG,EAAS,IAAI,CAAA,CAEnC"}